groups:
  - name: backend_alerts
    rules:
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le)) > 0.2
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High API Latency"
          description: "API latency is above 200ms for more than 2 minutes."

      - alert: HighErrorRate
        expr: (sum(rate(http_request_duration_seconds_count{code=~"5.."}[5m])) / sum(rate(http_request_duration_seconds_count[5m]))) * 100 > 5
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High Error Rate"
          description: "More than 5% of requests are resulting in 5xx errors for over 2 minutes."

      - alert: HighDBResponseTime
        expr: histogram_quantile(0.95, sum(rate(db_query_duration_seconds_bucket[5m])) by (le)) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High Database Response Time"
          description: "Database queries are taking longer than 100ms for over 2 minutes."
